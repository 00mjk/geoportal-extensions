<!DOCTYPE html>
<html>
    <head>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
        <meta charset="UTF-8">

        <!-- ol3 head common stuf -->
        <!-- Plugin Itowns IGN -->
        <link rel="stylesheet" href="../../dist/itowns/GpPluginItowns-src.css" />
        <!-- Library Itowns -->
        <script src="../../node_modules/itowns/dist/itowns.js"></script>
        <!-- Ressources -->
        <script src="../resources/itowns/layers.js" data-key="jhyvi0fgmnuxvfv0zjzorvdn"></script>

        <title>Sample itowns</title>
        <style>
            div#map {
                width: 100%;
                height: 500px;
            }
        </style>

    </head>
    <body>
        <h1>Extension GÃ©oportail pour Itowns avec ES6 module</h1>

            <h2>Ajout de tous les widgets</h2>
            <!-- map -->
            <div id="map">
            </div>

            <script type="module">

            import * as Gp from "../../dist/itowns/GpPluginItowns-src.js";

            var createMap = function() {
                /* global itowns,document,GuiTools*/
                const positionOnGlobe = { longitude: 2.3465, latitude: 48.88, altitude: 25000000 };

                // iTowns namespace defined here
                const viewerDiv = document.getElementById('map');
                const globeView = new itowns.GlobeViewExtended(viewerDiv, positionOnGlobe);

                globeView.listen(itowns.GlobeViewExtended.EVENTS.GLOBE_INITIALIZED, () => {

                    var mousePosition = new itowns.control.MousePosition({
                        collapsed: true,
                        displayCoordinates: true,
                        displayAltitude: true
                    });
                    globeView.addWidget( mousePosition );

                    var attribution = new itowns.control.Attributions({
                        options : {
                            collapsed : true
                        }
                    });
                    globeView.addWidget( attribution );

                    var layerSwitcher = new itowns.control.LayerSwitcher({
                        options : {
                            collapsed: true
                        },
                        layers : [
                            {
                                id : "ScanEX",
                                displayed : true
                            },
                            {
                                id : "Ortho",
                                displayed : true,
                                config : {
                                    title : "Couche de Photos IGNPO",
                                    description : "Description de ma couche",
                                    quicklookUrl : "lien/Vers/UnApercuRapide.png",
                                    legends : [
                                        {
                                            url : "lien/Vers/UneLegende.png"
                                        }
                                    ],
                                    metadata : [
                                        {
                                            url : "lien/Vers/Une/MetaDonnee.xml"
                                        }
                                    ],
                                    visibility: true,
                                    opacity: 0.8
                                }
                            }
                        ]
                    });
                    globeView.addWidget(layerSwitcher);
                    globeView.addLayer(layerOrtho);
                });

                var miniglobe = new itowns.control.MiniGlobe({
                    target : viewerDiv,
                    position : "absolute"
                });
                globeView.addWidget( miniglobe );

                var scalebar = new itowns.control.Scale({
                    target : viewerDiv,
                    position : "absolute"
                });
                globeView.addWidget( scalebar );

                //Add Layers
                itowns.Fetcher.json('../resources/itowns/JSONLayers/OrthosCRS.json').then(result => globeView.addLayer(result));
                itowns.Fetcher.json('../resources/itowns/JSONLayers/ScanEX.json').then(result => globeView.addLayer(result));
                itowns.Fetcher.json('../resources/itowns/JSONLayers/Region.json').then(result => globeView.addLayer(result));

                itowns.Fetcher.json('../resources/itowns/JSONLayers/IGN_MNT.json').then(result => globeView.addLayer(result));
                itowns.Fetcher.json('../resources/itowns/JSONLayers/IGN_MNT_HIGHRES.json').then(result => globeView.addLayer(result));
            }

            self.Gp.Services.getConfig({
                apiKey : "jhyvi0fgmnuxvfv0zjzorvdn",
                timeOut : 20000,
                onSuccess : createMap
            });

            </script>
    </body>
</html>
