!function(a,b){if("function"==typeof define&&define.amd)define(["leaflet","proj4"],b);else if("object"==typeof module&&"object"==typeof module.exports)L=require("leaflet"),proj4=require("proj4"),module.exports=b(L,proj4);else{if("undefined"==typeof a.L||"undefined"==typeof a.proj4)throw"Leaflet and proj4 must be loaded first";b(a.L,a.proj4)}}(this,function(a,b){return a.Proj={},a.Proj._isProj4Obj=function(a){return"undefined"!=typeof a.inverse&&"undefined"!=typeof a.forward},a.Proj.Projection=a.Class.extend({initialize:function(b,c,d){var e=a.Proj._isProj4Obj(b);this._proj=e?b:this._projFromCodeDef(b,c),this.bounds=e?c:d},project:function(b){var c=this._proj.forward([b.lng,b.lat]);return new a.Point(c[0],c[1])},unproject:function(b,c){var d=this._proj.inverse([b.x,b.y]);return new a.LatLng(d[1],d[0],c)},_projFromCodeDef:function(a,c){if(c)b.defs(a,c);else if(void 0===b.defs[a]){var d=a.split(":");if(d.length>3&&(a=d[d.length-3]+":"+d[d.length-1]),void 0===b.defs[a])throw"No projection definition for code "+a}return b(a)}}),a.Proj.CRS=a.Class.extend({includes:a.CRS,options:{transformation:new a.Transformation(1,0,-1,0)},initialize:function(b,c,d){var e,f,g,h;if(a.Proj._isProj4Obj(b)?(f=b,e=f.srsCode,h=c||{},this.projection=new a.Proj.Projection(f,h.bounds)):(e=b,g=c,h=d||{},this.projection=new a.Proj.Projection(e,g,h.bounds)),a.Util.setOptions(this,h),this.code=e,this.transformation=this.options.transformation,this.options.origin&&(this.transformation=new a.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales)this._scales=this.options.scales;else if(this.options.resolutions){this._scales=[];for(var i=this.options.resolutions.length-1;i>=0;i--)this.options.resolutions[i]&&(this._scales[i]=1/this.options.resolutions[i])}this.infinite=!this.options.bounds},scale:function(a){var c,d,e,f,b=Math.floor(a);return a===b?this._scales[a]:(c=this._scales[b],d=this._scales[b+1],e=d-c,f=a-b,c+e*f)},zoom:function(a){var d,e,b=this._closestElement(this._scales,a),c=this._scales.indexOf(b);return a===b?c:(d=c+1,e=this._scales[d]-b,(a-b)/e+c)},_closestElement:function(a,b){for(var c,d=a.length;d--;)a[d]<=b&&(void 0===c||c<a[d])&&(c=a[d]);return c}}),a.Proj.GeoJSON=a.GeoJSON.extend({initialize:function(b,c){if(b.crs&&"name"===b.crs.type){var d=new a.Proj.CRS(b.crs.properties.name);c=c||{},c.coordsToLatLng=function(b){var c=a.point(b[0],b[1]);return d.projection.unproject(c)}}a.GeoJSON.prototype.initialize.call(this,b,c)}}),a.Proj.geoJson=function(b,c){return new a.Proj.GeoJSON(b,c)},a.Proj});
